{
  "service_overview": {
    "svcName": "claims-service",
    "svcKey": "claims-svc",
    "svcVer": "1.2.0",
    "svcStatus": "Draft",
    "svcDate": "2025-11-03",
    "svcDomain": "Claims",
    "svcOwner": "Alice Smith",
    "svcTL": "Bob Johnson",
    "businessContext": "Process customer insurance claims from submission to payout.",
    "servicePurpose": "Validate, enrich, persist, and publish claim lifecycle events.",
    "externalBoundaries": "Payments handled by billing-service; policy data by policy-service.",
    "responsibilities": [
      { "name": "Validate claim inputs", "notes": "Schema + rules" },
      { "name": "Calculate eligibility", "notes": "Business rules engine" }
    ],
    "nonGoals": [
      { "text": "Process payments" }
    ],
    "useCases": [
      { "name": "Submit claim", "actor": "Customer", "outcome": "Claim created" },
      { "name": "Approve claim", "actor": "Agent", "outcome": "Claim approved" }
    ]
  },
  "api_specs": {
    "swaggerInName": "claims-api-in.json",
    "swaggerOutName": "claims-api-out.json",
    "endpoints": [
      {
        "path": "/claims",
        "method": "POST",
        "idempotent": false,
        "idempotency": null,
        "idem": { "keySource": "", "duplicateBehavior": "" },
        "errors": [
          { "code": "400", "meaning": "Invalid request" },
          { "code": "500", "meaning": "Server error" }
        ]
      },
      {
        "path": "/claims/{id}",
        "method": "GET",
        "idempotent": true,
        "idempotency": null,
        "idem": { "keySource": "", "duplicateBehavior": "" },
        "errors": [
          { "code": "404", "meaning": "Not found" }
        ]
      }
    ]
  },
  "msg_broker": {
    "rationale": ["decouple", "async", "reliability"],
    "published": [
      {
        "platform": "RabbitMQ",
        "kind": "RabbitMQ",
        "name": "claim.created",
        "event": "claim.created",
        "exchange": "claims.x",
        "routingKey": "claim.created",
        "schemaVersion": "1.0",
        "useCase": "Notify new claim",
        "delivery": "At-least-once",
        "ordering": "No",
        "payloadName": ""
      }
    ],
    "consumed": [
      {
        "platform": "Kafka",
        "kind": "Kafka",
        "name": "policy.updated",
        "topic": "policy.updated",
        "groupId": "claims-svc",
        "reset": "latest",
        "delivery": "At-least-once",
        "payloadName": ""
      }
    ]
  },
  "data_storage": {
    "dbEngine": "Postgres",
    "dbCluster": "prod-sql-01",
    "connString": "postgres://user:***@db/claims",
    "dbRationale": "Relational with ACID guarantees",
    "schemaSource": "Inline editor",
    "schemaInline": "CREATE TABLE claims(id UUID PRIMARY KEY, status TEXT);",
    "schemaVersion": "1.0.0",
    "schemaFileName": "",
    "retention": [
      {
        "name": "claims",
        "period": "7y",
        "strategy": "archive",
        "legal": "Yes",
        "notes": "Archive to cold storage"
      }
    ],
    "struct": {
      "indexes": [
        { "table": "claims", "columns": "status", "type": "btree", "unique": "No" }
      ],
      "partitioning": { "strategy": "none", "key": "", "notes": "" }
    }
  },
  "cache_layer": {
    "engine": "Redis",
    "usage": "Hot object caching (entities)",
    "usageCustom": "",
    "topology": "Primary/Replica",
    "size": "5 GB",
    "qps": "3000",
    "keyns": "svc:claims:v1:{id}",
    "serialization": "JSON",
    "ttl": "10m",
    "ttlOverrides": "",
    "compress": "Auto (size > N KB)",
    "evict": "allkeys-lru",
    "maxmem": "8 GB",
    "persist": "None (pure cache)",
    "replication": "Enabled (replica(s))",
    "hashtag": "{id}",
    "evictMemc": "",
    "memcMem": "",
    "invalidate": "Cache-aside (lazy)",
    "invCustom": "",
    "warmup": "Top 100 frequent claims",
    "auth": "Password/ACL",
    "tls": "TLS 1.2+",
    "metrics": "cpu, mem, hits/misses"
  },
  "security": {
    "authMethod": "OAuth 2.0 (Client Credentials)",
    "authMethodCustom": "",
    "authValidate": "JWKS (signature verify)",
    "authValidateCustom": "",
    "authExp": "1h",
    "scopes": [
      { "scope": "claims:read", "desc": "Read claims" },
      { "scope": "claims:write", "desc": "Create/update claims" }
    ],
    "authzModel": "RBAC",
    "authzModelCustom": "",
    "authzEngine": "OPA (Rego)",
    "authzEngineCustom": "",
    "authzEnforce": "API Gateway",
    "authzEnforceCustom": "",
    "permissions": [
      { "role": "Agent", "res": "claim", "act": "update", "cond": "ownsPolicy==true" }
    ],
    "auditScope": "All of the above",
    "auditRet": "1y",
    "auditDst": "Central log pipeline",
    "auditDstCustom": "",
    "auditFields": "subject, scopes, resource, decision, corrId",
    "pii": [
      { "field": "nationalId", "who": "Agent", "how": "Policy + consent" }
    ],
    "masking": [
      { "field": "nationalId", "kind": "hash", "custom": "" }
    ]
  },
  "observability": {
    "logProd": "INFO",
    "logStg": "DEBUG",
    "logDev": "DEBUG",
    "logSink": "Central log pipeline",
    "logSinkCustom": "",
    "tracing": "OpenTelemetry (OTLP)",
    "tracingCustom": "",
    "sampling": "10%",
    "propagation": "W3C traceparent",
    "metrics": [
      { "metric": "p95_latency", "type": "histogram", "slo": "<300ms", "collect": "OTEL SDK" }
    ],
    "dashboards": [
      { "name": "Claims API", "sys": "Grafana", "link": "grafana/claims" }
    ],
    "alerts": [
      { "sev": "High", "cond": "error_rate>2%", "chan": "Slack", "runbook": "Runbook-123" }
    ],
    "keyLogs": [
      { "type": "API request/response", "what": "duration,status,sanitized", "level": "INFO", "pii": "No" }
    ]
  },
  "perf_scalability": {
    "env": {
      "prod": { "rps": "1500", "p95": "300", "p99": "800", "err": "0.5", "slo": "99.9" },
      "stg":  { "rps": "300",  "p95": "400", "p99": "900", "err": "1.0", "slo": "99.5" },
      "dev":  { "rps": "50",   "p95": "500", "p99": "1200", "err": "2.0", "slo": "99.0" }
    },
    "cpu": "300m / 1000m",
    "mem": "512Mi / 1Gi",
    "warm": "20s / 60s",
    "minRep": "3",
    "maxRep": "12",
    "hpaMetric": "CPU %",
    "hpaTarget": "70",
    "hpaCustom": "",
    "pools": [
      { "comp": "Database", "max": "50", "to": "3000", "notes": "pg connections" },
      { "comp": "HTTP outbound", "max": "200", "to": "2000", "notes": "to policy-svc" }
    ],
    "rlPolicy": "Token bucket",
    "rlPolicyCustom": "",
    "rlLimit": "100 req / 1s per user",
    "rlScope": "Per user",
    "bp": "Circuit breaker",
    "bpCustom": "",
    "bpTh": "open at 20% errors/30s",
    "bpFail": "Graceful degrade"
  },
  "testing_strategy": {
    "apiTool": "Postman",
    "apiToolCustom": "",
    "apiCoverage": "Regression",
    "apiVersioning": "Header v1/v2 via gateway",
    "integration": [
      { "comp": "Database", "tool": "Flyway/Liquibase verify", "notes": "Migrations validated" }
    ],
    "perfTool": "k6",
    "perfToolCustom": "",
    "perfScen": "Spike",
    "perfData": "synthetic 10k claims",
    "perfTargets": "p95<300ms, err<0.5%",
    "perfEnv": "Prod-like staging",
    "perfReports": "S3://perf-reports",
    "chaosScen": "Dependency failure (5xx)",
    "chaosCustom": "",
    "chaosBlast": "Single pod",
    "chaosAbort": "error>2% 10m",
    "tdmApproach": "Hybrid (seed + synthetic)",
    "tdmAnon": "Mask",
    "tdmAnonCustom": "",
    "tdmCad": "weekly",
    "gates": [
      { "stage": "Staging", "tests": "integration + API", "pass": "p95<400ms" }
    ]
  },
  "deployment": {
    "image": "gcr.io/acme/claims:1.2.3",
    "kind": "Deployment",
    "rollout": "RollingUpdate",
    "repMin": "3",
    "repMax": "12",
    "rolling": "25%/25%",
    "canary": "10%-30%-100%",
    "live": "GET /healthz",
    "ready": "GET /ready",
    "start": "GET /startup",
    "svcType": "ClusterIP",
    "ports": "HTTP=8080",
    "ing": "Ingress",
    "ingCustom": "",
    "cfg": "Helm",
    "cfgCustom": "",
    "cm": "app.yaml, routes.json",
    "secrets": "db-cred, jwt-key",
    "aff": "zone=me-west1-b",
    "tol": "dedicated=true:NoSchedule",
    "pdb": "minAvailable=2",
    "rollback": "err>2%, p95>800ms for 10m",
    "pipeline": "GitHub Actions",
    "registry": "GCR"
  },
  "compliance_governance": {
    "regs": ["GDPR", "SOC 2"],
    "regsCustom": "",
    "class": "Confidential",
    "dpia": "No",
    "residency": "me-west1",
    "retention": "PII 7y, logs 1y",
    "worm": "WORM (bucket-level)",
    "encRest": "Provider-managed keys",
    "encTransit": "TLS 1.3",
    "secrets": "Cloud Secret Manager",
    "secretsCustom": "",
    "controls": [
      { "ref": "GDPR-32", "impl": "CMEK @ DB + TLS1.3", "evidence": "policy + KMS + config" }
    ],
    "accessCad": "Quarterly",
    "auditTrail": "Central log pipeline",
    "auditTrailCustom": "",
    "dsr": "Documented runbook",
    "exceptions": [
      { "type": "Policy exception", "desc": "Legacy endpoint no TLS", "owner": "Security", "mit": "Migrate by Q3" }
    ]
  },
  "final_chapter": {
    "decisions": [
      { "desc": "Use Postgres for claims", "rat": "ACID needed", "date": "2025-11-03", "by": "Architecture Board" }
    ],
    "questions": [
      { "q": "Support multi-region in phase 1?", "to": "Platform", "date": "2025-11-03", "pri": "High", "status": "Asked", "notes": "Cost impact" }
    ],
    "approvals": [
      { "role": "Lead Architect", "name": "Dana", "decision": "Approve", "date": "2025-11-03", "comments": "LGTM" }
    ]
  }
}

